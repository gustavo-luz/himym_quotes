!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);var r,o,i,u,a,c=Object({name:"P&G",pixelUrl:"https://pandg.tapad.com/tag",syncType:"IFRAME"});!function(t){t.FAILURE="failure",t.SUCCESS="success"}(r||(r={})),function(t){t.IFRAME="IFRAME",t.XHR="XHR"}(o||(o={})),function(t){t.BROWSER="BROWSER",t.AMP="AMP"}(i||(i={})),function(t){t.MM="mm",t.TTD="ttd"}(u||(u={})),function(t){t.js="js"}(a||(a={}));var l=function(){return(l=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},s=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]])}return e},f=function(t,n,e){if(e||2===arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))},p={initiator:a.js};function d(t,n){void 0===t&&(t={}),void 0===n&&(n=!1);var e,r=t.data,o=t.idParams,i=s(t,["data","idParams"]);return f(f(f([],function(t){return Object.entries(t).filter((function(t){t[0];return null!=t[1]})).map((function(t){var n=t[0],e=t[1];return encodeURIComponent(n)+"="+encodeURIComponent(e)}))}(l(l({},i),p)),!0),function(t,n){if(0===Object.keys(t).length)return[];if(!n)return["data="+encodeURIComponent(JSON.stringify(t))];return Object.entries(t).filter((function(t){t[0];return null!=t[1]})).map((function(t){var n=t[0],e=t[1];return"data."+encodeURIComponent(n)+"="+encodeURIComponent(e)}))}(null!=r?r:{},n),!0),(e=null!=o?o:{},Object.entries(e).filter((function(t){return t[0],null!=t[1]})).map((function(t){var n=t[0],e=t[1];return Object.entries(e).filter((function(t){return t[0],null!=t[1]})).map((function(t){var e=t[0],r=t[1];return"id."+n+"."+e+"="+encodeURIComponent(r)})).join("&")}))),!0).join("&")}var h=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))},y=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},v=function(){function t(t,n,e){this.config=t,this.metadata=n,this.windowRef=e,this.iframeUrl=this.config.pixelUrl}return t.prototype.sync=function(t){return h(this,void 0,void 0,(function(){return y(this,(function(n){switch(n.label){case 0:return[4,this.appendIframe(t)];case 1:return[2,n.sent()]}}))}))},t.prototype.appendIframe=function(t){var n;return h(this,void 0,void 0,(function(){var e,r;return y(this,(function(o){switch(o.label){case 0:return e=null!==(n=this.windowRef.document.body)&&void 0!==n?n:this.windowRef.document.getElementsByTagName("head")[0],(r=window.document.createElement("iframe")).height="0",r.width="0",r.frameBorder="0",r.src=this.iframeUrl+"?"+d(t,this.config.prettyPrintDataParams),r.style.display="none",[4,new Promise((function(t,n){r.onload=function(){return t()},r.onerror=function(t){return n(t)},e.insertBefore(r,e.lastChild)}))];case 1:return[2,o.sent()]}}))}))},t}();var b,w=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))},m=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},g=function(){function t(t,n,e){this.config=t,this.metadata=n,this.windowRef=e}return t.prototype.sync=function(t,n){return w(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this.callPixelServer(t,n)];case 1:return[2,e.sent()]}}))}))},t.prototype.callPixelServer=function(n,e){return w(this,void 0,void 0,(function(){var e,r;return m(this,(function(o){switch(o.label){case 0:return e=this.syncUrl()+"?"+d(n,this.config.prettyPrintDataParams),(r=new XMLHttpRequest).withCredentials=!0,r.open("GET",e),[4,new Promise((function(n,e){["abort","error","timeout"].forEach((function(t){return r.addEventListener(t,(function(t){e(t)}))})),r.addEventListener("load",(function(r){t.eventTargetIsXMLHttpRequest(r.target)&&200===r.target.status?n(r.target):e(r)})),r.send()}))];case 1:return[2,o.sent()]}}))}))},t.eventTargetIsXMLHttpRequest=function(t){return null!=t},t.prototype.syncUrl=function(){var t=this.metadata,n=t.tagId,e=t.accountId;return""+(null==this.config.pixelUrl?"http://localhost:9999/local-pixel-endpoint":this.config.pixelUrl)+(null!=n&&null!=e?"/accounts/"+e+"/tags/"+n+"/events":"")},t}(),x=(b=function(t,n){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}b(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),O=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))},P=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},S=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return x(n,t),n.prototype.sync=function(n){return O(this,void 0,void 0,(function(){var e,r;return P(this,(function(o){switch(o.label){case 0:return[4,t.prototype.sync.call(this,n)];case 1:return e=o.sent(),r=this.extractImgSourcesFromHtml(e.response),this.appendPixels(r),[2,e]}}))}))},n.prototype.extractImgSourcesFromHtml=function(t){if(null==t)return[];for(var n=[],e=/<img[^>]* src="([^"]*)"[^>]*>/g,r=e.exec(t);null!=r;)n.push(r[1]),r=e.exec(t);return n},n.prototype.appendPixels=function(t){var n=this;void 0===t&&(t=[]),t.forEach((function(t){var e=n.windowRef.document.createElement("amp-img");e.setAttribute("src",t),e.setAttribute("layout","fixed"),e.setAttribute("height","1"),e.setAttribute("width","1"),n.windowRef.document.body.appendChild(e)}))},n}(g);function j(){return(j=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)}var R,A=function(){return(A=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},I=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))},E=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},M=function(){function t(t,n,e){this.metadata=t,this.runtimeConfig=n,this.windowRef=e,this.config=j({},c,this.runtimeConfig);var r=this.config.env===i.AMP?S:this.config.syncType===o.IFRAME?v:g;this.pixelApi=new r(this.config,this.metadata,this.windowRef)}return t.init=function(n,e,r){return void 0===n&&(n={}),void 0===e&&(e={}),new t(n,e,null==r?window:r)},t.ampInitAndSync=function(){return I(this,void 0,void 0,(function(){var n,e,o,u,a,c,l;return E(this,(function(s){switch(s.label){case 0:return null==AMP||null==AMP.getState?[2,{status:r.FAILURE,error:"AMP not defined"}]:[4,AMP.getState("Tapad")];case 1:return n=s.sent(),e=this.coerceAmpState(n),o=e.config,u=e.metadata,a=e.data,c=e.ids,l={document},[4,t.init(u,A(A({},o),{env:i.AMP}),l).sync(a,c)];case 2:return[2,s.sent()]}}))}))},t.coerceAmpState=function(t){return null==t?{metadata:{},config:{},data:{},ids:{}}:function(t){if(null==t)return{};try{return JSON.parse(t)}catch(t){return{}}}(t)},t.prototype.sync=function(t,n){return I(this,void 0,void 0,(function(){var e;return E(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.pixelApi.sync(this.buildQueryParams(t,n))];case 1:return o.sent(),[2,{status:r.SUCCESS}];case 2:return e=o.sent(),[2,{status:r.FAILURE,error:e}];case 3:return[2]}}))}))},t.prototype.buildQueryParams=function(n,e){var r,o,i,u,c;return{gdpr:this.metadata.gdpr,us_privacy:this.metadata.ccpa,gdpr_consent:this.metadata.gdpr_consent,referrer_url:null===(r=this.windowRef.document)||void 0===r?void 0:r.referrer,page_url:null===(i=null===(o=this.windowRef.document)||void 0===o?void 0:o.location)||void 0===i?void 0:i.href,owner:this.config.name,bp_id:null!==(c=null!==(u=this.metadata.sid)&&void 0!==u?u:this.metadata.bpid)&&void 0!==c?c:this.metadata.bp_id,partner:this.config.partner,data:n,idParams:t.buildIdsQueryObject(e),initiator:a.js}},t.buildIdsQueryObject=function(t){if(null!=t)return Object.entries(t).reduce((function(t,n){var e=n[0],r=n[1];return t[e]="string"==typeof r?{value:r}:r,t}),{})},t}();null!=(null===(R=window.AMP)||void 0===R?void 0:R.getState)?M.ampInitAndSync():window.Tapad=M}]);